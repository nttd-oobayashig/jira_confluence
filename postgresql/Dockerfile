FROM postgres:9.6

RUN localedef -i ja_JP -c -f UTF-8 -A /usr/share/locale/locale.alias ja_JP.UTF-8
ENV LANG ja_JP.UTF-8

ARG CONFLUENCE_DB_USER=confluenceuser
ARG CONFLUENCE_DB_PASSWORD=password
ARG CONFLUENCE_DBNAME=confluencedb

ARG JIRA_DB_USER=jiradbuser
ARG JIRA_DB_PASSWORD=password
ARG JIRA_DBNAME=jiradb

ENV INITSQL_FILE=/docker-entrypoint-initdb.d/init.sql

RUN echo "CREATE ROLE $CONFLUENCE_DB_USER WITH LOGIN PASSWORD '$CONFLUENCE_DB_PASSWORD';" > $INITSQL_FILE
RUN echo "CREATE DATABASE $CONFLUENCE_DBNAME OWNER $CONFLUENCE_DB_USER ENCODING 'UTF8' LC_COLLATE 'ja_JP.UTF-8' TEMPLATE template0;" >> $INITSQL_FILE

RUN echo "CREATE ROLE $JIRA_DB_USER WITH LOGIN PASSWORD '$JIRA_DB_PASSWORD';" >> $INITSQL_FILE
RUN echo "CREATE DATABASE $JIRA_DBNAME WITH OWNER $JIRA_DB_USER ENCODING 'UNICODE' LC_COLLATE 'C' LC_CTYPE 'C' TEMPLATE template0;" >> $INITSQL_FILE

EXPOSE 5432

CMD ["postgres"]
